// Translations for password reset pages
const translations = {
  en: {
    choosePassword: {
      title: 'Reset Password',
      subtitle: 'Enter your new password below',
      newPasswordLabel: 'New Password',
      newPasswordPlaceholder: 'Enter your new password',
      confirmPasswordLabel: 'Confirm Password',
      confirmPasswordPlaceholder: 'Confirm your new password',
      requirementsTitle: 'Password requirements:',
      reqMinLength: 'Minimum 8 characters',
      reqCase: 'Uppercase, lowercase and numbers',
      reqSpecial: 'At least one special character (!@#$%^&*)',
      submitButton: 'Reset Password',
      processing: 'Processing...',
      passwordMismatch: 'Passwords do not match',
      errorMessage: 'Please fix the errors before continuing',
      successMessage: '✓ Password reset successfully! Redirecting...',
      errorReset: 'Error resetting password. Please request a new link.',
      errorProcessing: 'Error processing request. Try again.',
      footerText: 'Please do not reply to this email. This is an automated message.',
      footerAutoText: 'This email was sent automatically by the system.',
    },
    successPage: {
      title: 'Password Reset!',
      message: 'Your password has been successfully updated.<br>You can now log in with your new password.',
      loginButton: 'Log In',
      securityTip: 'Security Tip:',
      securityMessage: 'We recommend that you do not share your password and change it periodically to keep your account secure.',
      redirecting: 'Redirecting automatically in',
      seconds: 'seconds...',
    },
  },
  'pt-BR': {
    choosePassword: {
      title: 'Redefinir Senha',
      subtitle: 'Digite sua nova senha abaixo',
      newPasswordLabel: 'Nova Senha',
      newPasswordPlaceholder: 'Digite sua nova senha',
      confirmPasswordLabel: 'Confirmar Senha',
      confirmPasswordPlaceholder: 'Confirme sua nova senha',
      requirementsTitle: 'Requisitos da senha:',
      reqMinLength: 'Mínimo de 8 caracteres',
      reqCase: 'Letras maiúsculas, minúsculas e números',
      reqSpecial: 'Pelo menos um caractere especial (!@#$%^&*)',
      submitButton: 'Redefinir Senha',
      processing: 'Processando...',
      passwordMismatch: 'As senhas não coincidem',
      errorMessage: 'Por favor, corrija os erros antes de continuar',
      successMessage: '✓ Senha redefinida com sucesso! Redirecionando...',
      errorReset: 'Erro ao redefinir senha. Por favor, solicite um novo link.',
      errorProcessing: 'Erro ao processar solicitação. Tente novamente.',
      footerText: 'Por favor, não responda a este e-mail. Esta é uma mensagem automática.',
      footerAutoText: 'Este e-mail foi enviado automaticamente pelo sistema.',
    },
    successPage: {
      title: 'Senha Redefinida!',
      message: 'Sua senha foi atualizada com sucesso.<br>Agora você pode fazer login com sua nova senha.',
      loginButton: 'Fazer Login',
      securityTip: 'Dica de Segurança:',
      securityMessage: 'Recomendamos que você não compartilhe sua senha e a altere periodicamente para manter sua conta segura.',
      redirecting: 'Redirecionando automaticamente em',
      seconds: 'segundos...',
    },
  },
  pt: {
    choosePassword: {
      title: 'Redefinir Senha',
      subtitle: 'Digite sua nova senha abaixo',
      newPasswordLabel: 'Nova Senha',
      newPasswordPlaceholder: 'Digite sua nova senha',
      confirmPasswordLabel: 'Confirmar Senha',
      confirmPasswordPlaceholder: 'Confirme sua nova senha',
      requirementsTitle: 'Requisitos da senha:',
      reqMinLength: 'Mínimo de 8 caracteres',
      reqCase: 'Letras maiúsculas, minúsculas e números',
      reqSpecial: 'Pelo menos um caractere especial (!@#$%^&*)',
      submitButton: 'Redefinir Senha',
      processing: 'Processando...',
      passwordMismatch: 'As senhas não coincidem',
      errorMessage: 'Por favor, corrija os erros antes de continuar',
      successMessage: '✓ Senha redefinida com sucesso! Redirecionando...',
      errorReset: 'Erro ao redefinir senha. Por favor, solicite um novo link.',
      errorProcessing: 'Erro ao processar solicitação. Tente novamente.',
      footerText: 'Por favor, não responda a este e-mail. Esta é uma mensagem automática.',
      footerAutoText: 'Este e-mail foi enviado automaticamente pelo sistema.',
    },
    successPage: {
      title: 'Senha Redefinida!',
      message: 'Sua senha foi atualizada com sucesso.<br>Agora você pode fazer login com sua nova senha.',
      loginButton: 'Fazer Login',
      securityTip: 'Dica de Segurança:',
      securityMessage: 'Recomendamos que você não compartilhe sua senha e a altere periodicamente para manter sua conta segura.',
      redirecting: 'Redirecionando automaticamente em',
      seconds: 'segundos...',
    },
  },
  es: {
    choosePassword: {
      title: 'Restablecer Contraseña',
      subtitle: 'Ingrese su nueva contraseña a continuación',
      newPasswordLabel: 'Nueva Contraseña',
      newPasswordPlaceholder: 'Ingrese su nueva contraseña',
      confirmPasswordLabel: 'Confirmar Contraseña',
      confirmPasswordPlaceholder: 'Confirme su nueva contraseña',
      requirementsTitle: 'Requisitos de contraseña:',
      reqMinLength: 'Mínimo 8 caracteres',
      reqCase: 'Mayúsculas, minúsculas y números',
      reqSpecial: 'Al menos un carácter especial (!@#$%^&*)',
      submitButton: 'Restablecer Contraseña',
      processing: 'Procesando...',
      passwordMismatch: 'Las contraseñas no coinciden',
      errorMessage: 'Por favor, corrija los errores antes de continuar',
      successMessage: '✓ Contraseña restablecida con éxito! Redirigiendo...',
      errorReset: 'Error al restablecer la contraseña. Solicite un nuevo enlace.',
      errorProcessing: 'Error al procesar la solicitud. Intente nuevamente.',
      footerText: 'Por favor, no responda a este correo. Este es un mensaje automatizado.',
      footerAutoText: 'Este correo fue enviado automáticamente por el sistema.',
    },
    successPage: {
      title: '¡Contraseña Restablecida!',
      message: 'Su contraseña ha sido actualizada con éxito.<br>Ahora puede iniciar sesión con su nueva contraseña.',
      loginButton: 'Iniciar Sesión',
      securityTip: 'Consejo de Seguridad:',
      securityMessage: 'Recomendamos que no comparta su contraseña y la cambie periódicamente para mantener su cuenta segura.',
      redirecting: 'Redirigiendo automáticamente en',
      seconds: 'segundos...',
    },
  },
  fr: {
    choosePassword: {
      title: 'Réinitialiser le Mot de Passe',
      subtitle: 'Entrez votre nouveau mot de passe ci-dessous',
      newPasswordLabel: 'Nouveau Mot de Passe',
      newPasswordPlaceholder: 'Entrez votre nouveau mot de passe',
      confirmPasswordLabel: 'Confirmer le Mot de Passe',
      confirmPasswordPlaceholder: 'Confirmez votre nouveau mot de passe',
      requirementsTitle: 'Exigences du mot de passe:',
      reqMinLength: 'Minimum 8 caractères',
      reqCase: 'Majuscules, minuscules et chiffres',
      reqSpecial: 'Au moins un caractère spécial (!@#$%^&*)',
      submitButton: 'Réinitialiser le Mot de Passe',
      processing: 'Traitement...',
      passwordMismatch: 'Les mots de passe ne correspondent pas',
      errorMessage: 'Veuillez corriger les erreurs avant de continuer',
      successMessage: '✓ Mot de passe réinitialisé avec succès! Redirection...',
      errorReset: 'Erreur lors de la réinitialisation du mot de passe. Veuillez demander un nouveau lien.',
      errorProcessing: 'Erreur lors du traitement de la demande. Réessayez.',
      footerText: 'Veuillez ne pas répondre à cet e-mail. Ceci est un message automatisé.',
      footerAutoText: 'Cet e-mail a été envoyé automatiquement par le système.',
    },
    successPage: {
      title: 'Mot de Passe Réinitialisé!',
      message: 'Votre mot de passe a été mis à jour avec succès.<br>Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.',
      loginButton: 'Se Connecter',
      securityTip: 'Conseil de Sécurité:',
      securityMessage: 'Nous vous recommandons de ne pas partager votre mot de passe et de le changer périodiquement pour garder votre compte sécurisé.',
      redirecting: 'Redirection automatique dans',
      seconds: 'secondes...',
    },
  },
  de: {
    choosePassword: {
      title: 'Passwort Zurücksetzen',
      subtitle: 'Geben Sie unten Ihr neues Passwort ein',
      newPasswordLabel: 'Neues Passwort',
      newPasswordPlaceholder: 'Geben Sie Ihr neues Passwort ein',
      confirmPasswordLabel: 'Passwort Bestätigen',
      confirmPasswordPlaceholder: 'Bestätigen Sie Ihr neues Passwort',
      requirementsTitle: 'Passwortanforderungen:',
      reqMinLength: 'Mindestens 8 Zeichen',
      reqCase: 'Groß-, Kleinbuchstaben und Zahlen',
      reqSpecial: 'Mindestens ein Sonderzeichen (!@#$%^&*)',
      submitButton: 'Passwort Zurücksetzen',
      processing: 'Verarbeitung...',
      passwordMismatch: 'Passwörter stimmen nicht überein',
      errorMessage: 'Bitte korrigieren Sie die Fehler, bevor Sie fortfahren',
      successMessage: '✓ Passwort erfolgreich zurückgesetzt! Weiterleitung...',
      errorReset: 'Fehler beim Zurücksetzen des Passworts. Bitte fordern Sie einen neuen Link an.',
      errorProcessing: 'Fehler bei der Verarbeitung der Anfrage. Versuchen Sie es erneut.',
      footerText: 'Bitte antworten Sie nicht auf diese E-Mail. Dies ist eine automatisierte Nachricht.',
      footerAutoText: 'Diese E-Mail wurde automatisch vom System gesendet.',
    },
    successPage: {
      title: 'Passwort Zurückgesetzt!',
      message: 'Ihr Passwort wurde erfolgreich aktualisiert.<br>Sie können sich jetzt mit Ihrem neuen Passwort anmelden.',
      loginButton: 'Anmelden',
      securityTip: 'Sicherheitstipp:',
      securityMessage: 'Wir empfehlen, Ihr Passwort nicht zu teilen und es regelmäßig zu ändern, um Ihr Konto sicher zu halten.',
      redirecting: 'Automatische Weiterleitung in',
      seconds: 'Sekunden...',
    },
  },
  it: {
    choosePassword: {
      title: 'Reimposta Password',
      subtitle: 'Inserisci la tua nuova password qui sotto',
      newPasswordLabel: 'Nuova Password',
      newPasswordPlaceholder: 'Inserisci la tua nuova password',
      confirmPasswordLabel: 'Conferma Password',
      confirmPasswordPlaceholder: 'Conferma la tua nuova password',
      requirementsTitle: 'Requisiti della password:',
      reqMinLength: 'Minimo 8 caratteri',
      reqCase: 'Maiuscole, minuscole e numeri',
      reqSpecial: 'Almeno un carattere speciale (!@#$%^&*)',
      submitButton: 'Reimposta Password',
      processing: 'Elaborazione...',
      passwordMismatch: 'Le password non corrispondono',
      errorMessage: 'Si prega di correggere gli errori prima di continuare',
      successMessage: '✓ Password reimpostata con successo! Reindirizzamento...',
      errorReset: 'Errore durante il ripristino della password. Si prega di richiedere un nuovo link.',
      errorProcessing: 'Errore durante l\'elaborazione della richiesta. Riprova.',
      footerText: 'Si prega di non rispondere a questa email. Questo è un messaggio automatico.',
      footerAutoText: 'Questa email è stata inviata automaticamente dal sistema.',
    },
    successPage: {
      title: 'Password Reimpostata!',
      message: 'La tua password è stata aggiornata con successo.<br>Ora puoi accedere con la tua nuova password.',
      loginButton: 'Accedi',
      securityTip: 'Suggerimento di Sicurezza:',
      securityMessage: 'Ti consigliamo di non condividere la tua password e di cambiarla periodicamente per mantenere il tuo account sicuro.',
      redirecting: 'Reindirizzamento automatico tra',
      seconds: 'secondi...',
    },
  },
  hi: {
    choosePassword: {
      title: 'पासवर्ड रीसेट करें',
      subtitle: 'नीचे अपना नया पासवर्ड दर्ज करें',
      newPasswordLabel: 'नया पासवर्ड',
      newPasswordPlaceholder: 'अपना नया पासवर्ड दर्ज करें',
      confirmPasswordLabel: 'पासवर्ड की पुष्टि करें',
      confirmPasswordPlaceholder: 'अपने नए पासवर्ड की पुष्टि करें',
      requirementsTitle: 'पासवर्ड आवश्यकताएं:',
      reqMinLength: 'न्यूनतम 8 वर्ण',
      reqCase: 'बड़े अक्षर, छोटे अक्षर और संख्याएं',
      reqSpecial: 'कम से कम एक विशेष वर्ण (!@#$%^&*)',
      submitButton: 'पासवर्ड रीसेट करें',
      processing: 'प्रसंस्करण...',
      passwordMismatch: 'पासवर्ड मेल नहीं खाते',
      errorMessage: 'कृपया जारी रखने से पहले त्रुटियों को ठीक करें',
      successMessage: '✓ पासवर्ड सफलतापूर्वक रीसेट हो गया! पुनर्निर्देशन...',
      errorReset: 'पासवर्ड रीसेट करने में त्रुटि। कृपया एक नया लिंक का अनुरोध करें।',
      errorProcessing: 'अनुरोध संसाधित करने में त्रुटि। पुनः प्रयास करें।',
      footerText: 'कृपया इस ईमेल का जवाब न दें। यह एक स्वचालित संदेश है।',
      footerAutoText: 'यह ईमेल सिस्टम द्वारा स्वचालित रूप से भेजा गया था।',
    },
    successPage: {
      title: 'पासवर्ड रीसेट हो गया!',
      message: 'आपका पासवर्ड सफलतापूर्वक अपडेट कर दिया गया है।<br>अब आप अपने नए पासवर्ड से लॉगिन कर सकते हैं।',
      loginButton: 'लॉगिन करें',
      securityTip: 'सुरक्षा सुझाव:',
      securityMessage: 'हम अनुशंसा करते हैं कि आप अपना पासवर्ड साझा न करें और अपने खाते को सुरक्षित रखने के लिए इसे समय-समय पर बदलें।',
      redirecting: 'स्वचालित रूप से पुनर्निर्देशित हो रहा है',
      seconds: 'सेकंड में...',
    },
  },
};

// Get user language from URL, API, or browser
async function getUserLanguage() {
  const urlParams = new URLSearchParams(window.location.search);
  const urlLang = urlParams.get('lang');
  
  // Priority 1: URL parameter
  if (urlLang && translations[urlLang]) {
    return urlLang;
  }
  
  // Priority 2: Try to get from API using username in URL
  const username = urlParams.get('username');
  if (username) {
    try {
      const response = await fetch(`/app/functions/getUserLanguage`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Parse-Application-Id': urlParams.get('id') || 'OpenSignBR',
        },
        body: JSON.stringify({ username }),
      });
      
      if (response.ok) {
        const data = await response.json();
        if (data.result && translations[data.result]) {
          return data.result;
        }
      }
    } catch (error) {
      console.log('Could not fetch user language from API:', error);
    }
  }
  
  // Priority 3: Browser language
  const browserLang = navigator.language || navigator.userLanguage;
  if (translations[browserLang]) {
    return browserLang;
  }
  
  const baseLang = browserLang.split('-')[0];
  if (translations[baseLang]) {
    return baseLang;
  }
  
  // Default: English
  return 'en';
}
